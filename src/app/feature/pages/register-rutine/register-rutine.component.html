<div class="container p-3" style="margin-top: 80px">
  <h2>Crear nueva rutina</h2>
  <p>Seleccione los ejercicios que desea incluir en la rutina.</p>
  <form
    *ngIf="formularioRutina"
    [formGroup]="formularioRutina"
    (ngSubmit)="registerRutine()"
    enctype="multipart/form-data"
  >
    <div class="mb-3">
      <label class="form-label"> Nombre de la rutina </label>
      <input
        formControlName="nombre"
        type="text"
        class="form-control form-control-lg"
        id="nombreRutina"
        aria-describedby="nombreRutinaHelp"
        [(ngModel)]="nombre"
      />
    </div>

    <div>
      <label class="form-label"> Descripción de la rutina </label>
      <input
        formControlName="descripcion"
        type="text"
        class="form-control form-control-lg"
        id="descripcion"
        aria-describedby="descripcionRutinaHelp"
        [(ngModel)]="descripcion"
      />
    </div>

    <div>
      <label class="form-label"> cargar Foto rutina </label>
      <input
        formControlName="fotoRutina"
        type="file"
        class="form-control form-control-lg"
        id="fotoRutina"
        aria-describedby="fotoRutinaHelp"
        (change)="onFileSelected($event)"
      />
    </div>

    <div>
      <label class="form-label"> Enfoque de la rutina </label>
      <select
        formControlName="enfoque"
        class="form-select form-select-lg"
        id="enfoqueRutina"
        aria-describedby="enfoqueRutinaHelp"
        [(ngModel)]="enfoque"
      >
        <option value="TREN_SUPERIOR">Tren Superior</option>
        <option value="TREN_INFERIOR">Tren Inferior</option>
        <option value="FULL_BODY">Cuerpo Completo</option>
      </select>
    </div>

    <div>
      <label class="form-label"> Seleccione la dificultad de la rutina </label>
      <select
        formControlName="dificultad"
        class="form-select form-select-lg"
        id="dificultadRutina"
        aria-describedby="dificultadRutinaHelp"
        [(ngModel)]="dificultad"
      >
        <option value="Principiante">Principiante</option>
        <option value="Intermedio">Intermedio</option>
        <option value="Avanzado">Avanzado</option>
      </select>
    </div>

    <div>
      <label>Cantidad de ejercicios</label>
      <select
        type="number"
        formControlName="cantidadEjercicios"
        class="form-select"
        [value]="1"
        (change)="onCantidadChange($event)"
      >
        <option *ngFor="let num of [1, 2, 3, 4, 5]" [value]="num">
          {{ num }}
        </option>
      </select>
    </div>

    <div formArrayName="ejercicios">
      <div
        *ngFor="let grupo of ejerciciosFormArray.controls; let i = index"
        [formGroupName]="i"
        class="mt-3 border p-2 rounded"
      >
        <label>Ejercicio {{ i + 1 }}</label> <br />

        <label for="idEjercicio">Selecciona un ejercicio:</label>

        <select
          formControlName="idEjercicio"
          class="form-select mb-2"
          aria-describedby="ejercicioRutinaHelp"
        >
          <option value="">-- Selecciona --</option>
          <option
            *ngFor="let ejercicio of ejercicios"
            [value]="ejercicio.idEjercicio"
          >
            {{ ejercicio.nombreEjercicio }}
          </option>
        </select>

        <input
          formControlName="series"
          placeholder="Series"
          class="form-control mb-2"
          type="number"
        />
        <input
          formControlName="repeticion"
          placeholder="Repeticiones"
          class="form-control mb-2"
          type="number"
        />

        <input
          formControlName="carga"
          placeholder="Carga (Kg)"
          class="form-control mb-2"
          type="number"
        />
        <input
          formControlName="duracion"
          placeholder="Duración (Seg)"
          class="form-control mb-2"
          type="number"
        />
      </div>
    </div>
    <!-- Error de duplicados -->
    <div
      *ngIf="ejerciciosFormArray.errors?.['ejerciciosDuplicados']"
      class="text-danger mt-2"
    >
      No puedes seleccionar el mismo ejercicio más de una vez.
    </div>

    <div class="mt-3">
      <button type="submit" class="btn btn-success">Crear Rutina</button>

      <button
        class="btn btn-success"
        style="margin-left: 10px"
        onclick="window.history.back()"
      >
        Volver al Dashboard
      </button>
    </div>
  </form>

  <div *ngIf="mensajeExito" class="alert alert-success">
    {{ mensajeExito }}
  </div>
</div>
